<?php################################################################################ LEGAL NOTICE                                                                ################################################################################# Copyright (C) 2008/2009  Florent Denis                                      ## http://www.florentdenis.net                                                 ##                                                                             ## This program is free software: you can redistribute it and/or modify        ## it under the terms of the GNU General Public License as published by        ## the Free Software Foundation, either version 3 of the License, or           ## (at your option) any later version.                                         ##                                                                             ## This program is distributed in the hope that it will be useful,             ## but WITHOUT ANY WARRANTY; without even the implied warranty of              ## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               ## GNU General Public License for more details.                                ##                                                                             ## You should have received a copy of the GNU General Public License           ## along with this program.  If not, see <http://www.gnu.org/licenses/>        ################################################################################use pok\Apps\Membre,    pok\Apps\Outils\Mail,    pok\Apps\Outils\Session,    pok\Controleur\Page AS CPage,    systems\cfg\general;if( !Session::connecter() && Session::verifieJeton(0) && isset($_POST['votreemail'],$_GET['arbo']) && filter_var($_POST['votreemail'], FILTER_VALIDATE_EMAIL) !== false ){  // on import la class Membres et on l'instancie  pok\import_lib_cms('Membres');  $mSql = new Membre(array(array(    'email' => array( '=', $_POST['votreemail'] )  )));  $mymembre = $mSql->publier();  // si on a bien un compte  if( !empty($mymembre[0]) )  {    // on génère le nouveau mot de passe    // on met à jour le mot de passe    $mymembre[0]['membre_mdp'] = pok\Texte::generateur(6);    $mymembre[0]->modifier();        // on charge la class Mail du framework    $mail = new Mail();    // sujet du mail    $mail->subject = 'Nouveau mot de passe -pok-';    // corps du mail    $mail->html = '<h1>Nouveau mot de passe</h1>    <p>Vous avez généré un nouveau mot de passe.</p>    <p>Voici votre nouvelle indantifiant :<br />    Mot de passe : ' . $mymembre[0]['membre_mdp'] . '</p>';    // destinataire du mail :    $mail->addTo($_POST['votreemail']);    // emetteur du mail :    $mail->setHeadersFrom(general\MAIL_FROM);    // on envoie le mail    if( $mail->sendMail() )      CPage::redirect(CPage::url($_GET['arbo'],'','&mdp=ok' ) );  }  CPage::redirect(CPage::url($_GET['arbo'],'','&mdp=mail_erreur' ) );}